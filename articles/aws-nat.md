---
title: "AWS VPCのNATインスタンスとNATゲートウェイ"
emoji: "😸" 
type: "tech" 
topics: ["aws", "vpc"] 
published: true 
---

## AWS VPCのサブネット分離

AWS VPCでは、セキュアなネットワークのため、サブネットを以下のように分離するパターンがよく採用されます。

* インターネットに直接接続するパブリックサブネット
* NAT経由でインターネットに接続するプライベートサブネット

## NAT構成パターン

AWS VPCにて、NATを確立するために以下のパターンがあります。

* NATゲートウェイ
* NATインスタンス(EC2)

いずれもインターネットへのルーティング先(0.0.0.0/0)として、プライベートサブネットのルートテーブルに割り当てられます。

### NATゲートウェイ

![](/images/aws-nat/nat-gateway.png)  

NATゲートウェイはAWSマネージドサービスであるためメンテナンス不要で、トラフィックに応じた十分な性能およびMultiAZ冗長性も確保されます。

稼働時間料金で33.48USD/月、これに加えてデータ処理および転送料金が発生します。

一時的な停止等はできません。

### NATインスタンス(EC2)

![](/images/aws-nat/nat-instance.png)  

NATインスタンスは、NAT用AMIで作成したEC2インスタンスをパブリックサブネットに配置します。

性能・冗長性を適切な調整やセキュリティアップデート等のメンテナンスが必要です。

稼働時間料金はEC2インスタンスタイプに依存します。

こちらはEC2インスタンスなので一時停止が可能です。


## どちらを採用するべきか

プロダクション環境であれば、NATゲートウェイの方が安心できます。

検証環境等であれば、本番環境であっても、コストにシビアであったり、サービスが小規模な場合は、NATインスタンスにして運用コストを下げる選択もできます。

料金は一概に比較はできませんが、t3.microのオンデマンドで10.12USD程度で、SavingsPlans等によってさらに割安にできます。
